<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
  <title layout:fragment="title">Chi tiết danh mục - Quản lý danh mục</title>
</head>
<body>

<div layout:fragment="content">
  
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a th:href="@{/admin/categories}">
          <i class="fas fa-home me-1"></i>Trang chủ
        </a>
      </li>
      <li class="breadcrumb-item">
        <a th:href="@{/admin/categories}">
          <i class="fas fa-tags me-1"></i>Danh mục
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        Chi tiết
      </li>
    </ol>
  </nav>

  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h3 class="mb-0">
          <i class="fas fa-eye me-2 text-info"></i>Chi tiết danh mục
        </h3>
        <p class="text-muted mb-0">
          Thông tin chi tiết về danh mục: 
          <span class="fw-bold" th:text="${category.categoryName}">Tên danh mục</span>
        </p>
      </div>
      <div class="col-md-6 text-end">
        <a th:href="@{'/admin/categories/edit/' + ${category.categoryId}}" 
           class="btn btn-warning me-2">
          <i class="fas fa-edit me-2"></i>Chỉnh sửa
        </a>
        <a th:href="@{/admin/categories}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
        </a>
      </div>
    </div>
  </div>

  <!-- Category Details -->
  <div class="row">
    <!-- Main Information -->
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>Thông tin cơ bản
          </h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label text-muted">
                <i class="fas fa-hashtag me-1"></i>ID danh mục
              </label>
              <div class="fw-bold fs-5" th:text="${category.categoryId}">1</div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label text-muted">
                <i class="fas fa-toggle-on me-1"></i>Trạng thái
              </label>
              <div>
                <span th:if="${category.status}" class="badge bg-success fs-6">
                  <i class="fas fa-check-circle me-1"></i>Đang hoạt động
                </span>
                <span th:if="${!category.status}" class="badge bg-secondary fs-6">
                  <i class="fas fa-pause-circle me-1"></i>Vô hiệu hóa
                </span>
              </div>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label text-muted">
              <i class="fas fa-tag me-1"></i>Tên danh mục
            </label>
            <div class="fw-bold fs-4 text-primary" th:text="${category.categoryName}">
              Tên danh mục
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label text-muted">
              <i class="fas fa-align-left me-1"></i>Mô tả
            </label>
            <div th:if="${category.description != null and !#strings.isEmpty(category.description)}" 
                 class="p-3 border rounded bg-light">
              <p class="mb-0" th:text="${category.description}">Mô tả danh mục</p>
            </div>
            <div th:if="${category.description == null or #strings.isEmpty(category.description)}" 
                 class="text-muted fst-italic">
              <i class="fas fa-info-circle me-1"></i>Chưa có mô tả
            </div>
          </div>
        </div>
      </div>
      
      <!-- Timeline -->
      <div class="card mt-4">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-history me-2"></i>Lịch sử thay đổi
          </h6>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker bg-success">
                <i class="fas fa-plus text-white"></i>
              </div>
              <div class="timeline-content">
                <h6 class="timeline-title">Tạo danh mục</h6>
                <p class="timeline-description text-muted mb-1">
                  Danh mục được tạo lần đầu
                </p>
                <small class="text-muted">
                  <i class="fas fa-clock me-1"></i>
                  <span th:text="${#temporals.format(category.createdAt, 'dd/MM/yyyy HH:mm:ss')}">
                    01/01/2024 10:30:00
                  </span>
                </small>
              </div>
            </div>
            
            <div class="timeline-item" th:if="${category.updatedAt != null and category.updatedAt != category.createdAt}">
              <div class="timeline-marker bg-warning">
                <i class="fas fa-edit text-white"></i>
              </div>
              <div class="timeline-content">
                <h6 class="timeline-title">Cập nhật gần nhất</h6>
                <p class="timeline-description text-muted mb-1">
                  Danh mục được cập nhật lần cuối
                </p>
                <small class="text-muted">
                  <i class="fas fa-clock me-1"></i>
                  <span th:text="${#temporals.format(category.updatedAt, 'dd/MM/yyyy HH:mm:ss')}">
                    01/01/2024 15:45:00
                  </span>
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Icon Card -->
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-image me-2"></i>Icon danh mục
          </h6>
        </div>
        <div class="card-body text-center">
          <div th:if="${category.icon != null and !#strings.isEmpty(category.icon)}">
            <img th:src="@{'/images/' + ${category.icon}}" 
                 alt="Category Icon" class="img-fluid rounded border mb-3" 
                 style="max-width: 200px; max-height: 200px; object-fit: cover;"
                 onerror="this.src='https://via.placeholder.com/200x200/e9ecef/6c757d?text=Error'">
            <div class="text-success">
              <i class="fas fa-check-circle me-1"></i>
              <strong>Có icon</strong>
            </div>
            <small class="text-muted d-block mt-1">
              <i class="fas fa-file me-1"></i>
              File: <span th:text="${category.icon}">icon.jpg</span>
            </small>
          </div>
          
          <div th:if="${category.icon == null or #strings.isEmpty(category.icon)}">
            <div class="bg-light rounded border d-flex align-items-center justify-content-center mb-3" 
                 style="width: 150px; height: 150px; margin: 0 auto;">
              <i class="fas fa-image fa-3x text-muted"></i>
            </div>
            <div class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              <strong>Chưa có icon</strong>
            </div>
            <small class="text-muted d-block mt-1">
              Danh mục này chưa có icon hiển thị
            </small>
            <a th:href="@{'/admin/categories/edit/' + ${category.categoryId}}" 
               class="btn btn-sm btn-outline-primary mt-2">
              <i class="fas fa-upload me-1"></i>Thêm icon
            </a>
          </div>
        </div>
      </div>
      
      <!-- Action Card -->
      <div class="card mt-4">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-tools me-2"></i>Thao tác
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a th:href="@{'/admin/categories/edit/' + ${category.categoryId}}" 
               class="btn btn-warning">
              <i class="fas fa-edit me-2"></i>Chỉnh sửa
            </a>
            
            <button type="button" class="btn btn-outline-warning" 
                    th:onclick="'toggleStatus(' + ${category.categoryId} + ')'"
                    th:class="${category.status ? 'btn btn-outline-secondary' : 'btn btn-outline-success'}">
              <i th:class="${category.status ? 'fas fa-pause me-2' : 'fas fa-play me-2'}"></i>
              <span th:text="${category.status ? 'Vô hiệu hóa' : 'Kích hoạt'}">Thay đổi trạng thái</span>
            </button>
            
            <hr class="my-2">
            
            <button type="button" class="btn btn-outline-danger" 
                    th:onclick="'deleteCategory(' + ${category.categoryId} + ', \'' + ${category.categoryName} + '\')'">
              <i class="fas fa-trash me-2"></i>Xóa danh mục
            </button>
          </div>
        </div>
      </div>
      
      <!-- Statistics Card -->
      <div class="card mt-4">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-chart-bar me-2"></i>Thống kê
          </h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <div class="border-end">
                <div class="fs-4 fw-bold text-primary">0</div>
                <small class="text-muted">Sản phẩm</small>
              </div>
            </div>
            <div class="col-6">
              <div class="fs-4 fw-bold text-success">
                <span th:text="${#temporals.format(category.createdAt, 'dd')}">01</span>
              </div>
              <small class="text-muted">Ngày tạo</small>
            </div>
          </div>
          <hr class="my-3">
          <div class="text-center">
            <small class="text-muted">
              <i class="fas fa-calendar me-1"></i>
              Đã tồn tại 
              <span th:text="${T(java.time.temporal.ChronoUnit).DAYS.between(category.createdAt, T(java.time.LocalDateTime).now())}">0</span>
              ngày
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden forms for actions -->
  <form id="deleteForm" method="post" style="display: none;">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
  </form>
  
  <form id="statusForm" method="post" style="display: none;">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
  </form>

</div>

<th:block layout:fragment="head">
<style>
.timeline {
  position: relative;
  padding-left: 30px;
}

.timeline-item {
  position: relative;
  margin-bottom: 20px;
}

.timeline-item:not(:last-child)::before {
  content: '';
  position: absolute;
  left: -19px;
  top: 30px;
  width: 2px;
  height: calc(100% + 10px);
  background-color: #e9ecef;
}

.timeline-marker {
  position: absolute;
  left: -30px;
  top: 0;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 3px solid #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.timeline-content {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 15px;
  border-left: 3px solid #dee2e6;
}

.timeline-title {
  margin-bottom: 5px;
  font-size: 0.95rem;
  font-weight: 600;
}

.timeline-description {
  font-size: 0.9rem;
  margin-bottom: 5px;
}
</style>
</th:block>

<th:block layout:fragment="scripts">
<script>
function deleteCategory(categoryId, categoryName) {
  if (confirm('Bạn có chắc chắn muốn xóa danh mục "' + categoryName + '"?\n\nHành động này không thể hoàn tác!')) {
    const form = document.getElementById('deleteForm');
    form.action = '/admin/categories/delete/' + categoryId;
    form.submit();
  }
}

function toggleStatus(categoryId) {
  const form = document.getElementById('statusForm');
  form.action = '/admin/categories/toggle-status/' + categoryId;
  form.submit();
}
</script>
</th:block>

</body>
</html>